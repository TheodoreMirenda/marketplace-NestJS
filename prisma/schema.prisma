generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  uuid String @unique
  password String

  username String @unique
  email String @unique

  firstName String
  lastName String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  type Role @default(USER)
  id Int @id @default(autoincrement())

  avatar String
  orders Order[] //1:M
  vendor Vendor? //1:1
}

model Vendor {
  id Int @id @default(autoincrement())
  uuid String @unique
  user User @relation(fields: [uuid], references: [uuid])

  vendorName String @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  vendor_products Vendor_Product[]
}

model Vendor_Product {
  id Int @id @default(autoincrement())
  uuid String @unique

  quantity Int
  categoryId Int @map("category_id")
  category Category @relation(fields: [categoryId], references: [id])
  vendorId Int @map("vendor_id")
  vendor Vendor @relation(fields: [vendorId], references: [id])
  product Product?//1:1

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id Int @id @default(autoincrement())
  uuid String @unique

  name String
  description String
  images String[]
  price Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  categoryId Int @map("category_id")
  category Category @relation(fields: [categoryId], references: [id])

  vendorProductId Int @map("vendor_product_id") @unique
  vendorProduct Vendor_Product @relation(fields: [vendorProductId], references: [id])//1:1

  // orders Order[]
}

//should this be an enum?
model Category {
  id Int @id @default(autoincrement())
  uuid String @unique

  name String @unique
  products Product[]
  vendorProducts Vendor_Product[]//1:M
}

model Order {
  id Int @id @default(autoincrement())
  uuid String @unique
  userId Int @map("user_id")
  vendorId Int @map("vendor_id")

  orderStatus OrderStatus @default(PLACED)
  user User @relation(fields: [userId], references: [id])//do I need this?
  productIds Int[] @map("product_ids")
  // products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum OrderStatus {
  PLACED
  INTRANSIT
  COMPLETED
  CANCELLED
}

enum Role {
  USER
  VENDOR
  ADMIN
}
